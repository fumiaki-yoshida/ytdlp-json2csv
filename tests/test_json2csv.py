import os
import json
from src import json2csv


sample_file_path = os.path.join(
    os.path.dirname(__file__), "sample_folder/20231112_ch-name_title.live_chat.json"
)


def test_open_files2lists():
    lines = json2csv.open_files2list(sample_file_path)
    assert len(lines) > 10


def test_split_comment_and_clickTrackingParams():
    lines = json2csv.open_files2list(sample_file_path)
    comments, click_tp = json2csv.split_comment_and_clickTrackingParams(lines)
    assert len(comments) > len(click_tp)


def test_has_addChatItemAction():
    dat_True = json.loads(
        '{"clickTrackingParams": "CAEQl98daBIhMIs7qIyKuEgwMVmchMAh0LIwfj", "replayChatItemAction": {"actions": [{"clickTrackingParams": "CAEQl98BIhMIs7qIyKuEgwMVmchMAh0LIwfj", "addChatItemAction": {"item": {"liveChatPaidMessageRenderer": {"id": "ChwKGkNLUGg3N3otMllJREZTUEN3Z1FkSWxrRTJB", "timestampUsec": "1700737983561607", "authorName": {"simpleText": "Jack Krauser"}, "authorPhoto": {"thumbnails": [{"url": "https://yt4.ggpht.com/ytc/APkrFKZx0LwFARGyWQmtlUlNeq1XcwEe0JZhstf6cQ=s32-c-k-c0x00ffffff-no-rj", "width": 32, "height": 32}, {"url": "https://yt4.ggpht.com/ytc/APkrFKZx0LwFARGyWQmtlUlNeq1XcwEe0JZhstf6cQ=s64-c-k-c0x00ffffff-no-rj", "width": 64, "height": 64}]}, "purchaseAmountText": {"simpleText": "NT$30.00"}, "message": {"runs": [{"text": "ヴォカルすげー"}]}, "headerBackgroundColor": 4278237396, "headerTextColor": 4278190080, "bodyBackgroundColor": 4278248959, "bodyTextColor": 4278190080, "authorExternalChannelId": "UCo_8LZtKaasyYncLnKjnMXA", "authorNameTextColor": 3003121664, "contextMenuEndpoint": {"clickTrackingParams": "CAIQ7rsEIhMIs7qIyKuEgwMVmchMAh0LIwfj", "commandMetadata": {"webCommandMetadata": {"ignoreNavigation": true}}, "liveChatItemContextMenuEndpoint": {"params": "Q2g0S0hBb2FRMHRRYURjM2VpMHlXVWxFUmxOUVEzZG5VV1JKYkd0Rk1rRWFLU29uQ2hoVlEwbGtSVWxJY0ZNd1ZHUnJjVkpyU0V3MVQydE1kRUVTQzNaWlVHTnBVMXBQYVVOVklBRW9BVElhQ2hoVlEyOWZPRXhhZEV0aFlYTjVXVzVqVEc1TGFtNU5XRUU0QWtnQlVBOCUzRA=="}}, "timestampColor": 2147483648, "contextMenuAccessibility": {"accessibilityData": {"label": "Chat actions"}}, "timestampText": {"simpleText": "13:36"}, "trackingParams": "CAIQ7rsEIhMIs7qIyKuEgwMVmchMAh0LIwfj", "textInputBackgroundColor": 822083583, "creatorHeartButton": {"creatorHeartViewModel": {"creatorThumbnail": {"sources": [{"url": "https://yt3.ggpht.com/Qj-lyidMW6xtEdnv6rDYscGE1kO6K06-i4v8Eiij96YOTo_WdBboLVlEKeE3749ywpyqTec2=s48-c-k-c0x00ffffff-no-rj"}]}, "heartedIcon": {"sources": [{"clientResource": {"imageName": "full_heart-filled"}}]}, "unheartedIcon": {"sources": [{"clientResource": {"imageName": "full_heart"}}], "processor": {"borderImageProcessor": {"imageTint": {"color": 4278190080}}}}, "heartedHoverText": "❤ by さなちゃんねる", "heartedAccessibilityLabel": "Remove heart", "unheartedAccessibilityLabel": "Heart", "engagementStateKey": "EktsaXZlLWNoYXQtbWVzc2FnZS1lbmdhZ2VtZW50LXN0YXRlLUNod0tHa05MVUdnM04zb3RNbGxKUkVaVFVFTjNaMUZrU1d4clJUSkIgLCgB"}}, "isV2Style": true}}, "clientId": "CKPh77z-2YIDFSPCwgQdIlkE2A"}}], "videoOffsetTimeMsec": "816855"}}'
    )
    dat_False = json.loads(
        '{"clickTrackingParams": "CAEQl98BIhMIy5G9z_3mggMVgNlMAh3W1gHd", "replayChatItemAction": {"actions": [{"clickTrackingParams": "CAEQl98BIhMIy5G9z_3mggMVgNlMAh3W1gHd", "addLiveChatTickerItemAction": {"item": {"liveChatTickerPaidMessageItemRenderer": {"id": "ChwKGkNJenFuYXpRdm9JREZZUVhmUW9kV2RjRWJB", "amountTextColor": 3741319168, "startBackgroundColor": 4294953512, "endBackgroundColor": 4294947584, "authorPhoto": {"thumbnails": [{"url": "https://yt4.ggpht.com/ytc/APkrFKb_CA1XB8fRw1jKL3eavN70M0HFONyNBdE13m9FOA=s32-c-k-c0x00ffffff-no-rj", "width": 32, "height": 32}, {"url": "https://yt4.ggpht.com/ytc/APkrFKb_CA1XB8fRw1jKL3eavN70M0HFONyNBdE13m9FOA=s64-c-k-c0x00ffffff-no-rj", "width": 64, "height": 64}], "accessibility": {"accessibilityData": {"label": "のら"}}}, "durationSec": 300, "showItemEndpoint": {"clickTrackingParams": "CAIQsMgEIhMIy5G9z_3mggMVgNlMAh3W1gHd", "commandMetadata": {"webCommandMetadata": {"ignoreNavigation": true}}, "showLiveChatItemEndpoint": {"renderer": {"liveChatPaidMessageRenderer": {"id": "ChwKGkNJenFuYXpRdm9JREZZUVhmUW9kV2RjRWJB", "timestampUsec": "1699797836186236", "authorName": {"simpleText": "のら"}, "authorPhoto": {"thumbnails": [{"url": "https://yt4.ggpht.com/ytc/APkrFKb_CA1XB8fRw1jKL3eavN70M0HFONyNBdE13m9FOA=s32-c-k-c0x00ffffff-no-rj", "width": 32, "height": 32}, {"url": "https://yt4.ggpht.com/ytc/APkrFKb_CA1XB8fRw1jKL3eavN70M0HFONyNBdE13m9FOA=s64-c-k-c0x00ffffff-no-rj", "width": 64, "height": 64}]}, "purchaseAmountText": {"simpleText": "¥1,000"}, "headerBackgroundColor": 4294947584, "headerTextColor": 3741319168, "bodyBackgroundColor": 4294953512, "bodyTextColor": 3741319168, "authorExternalChannelId": "UCmWgfTBP2gOjPr91uraUzsQ", "authorNameTextColor": 2315255808, "contextMenuEndpoint": {"clickTrackingParams": "CAQQ7rsEIhMIy5G9z_3mggMVgNlMAh3W1gHd", "commandMetadata": {"webCommandMetadata": {"ignoreNavigation": true}}, "liveChatItemContextMenuEndpoint": {"params": "Q2g0S0hBb2FRMGw2Y1c1aGVsRjJiMGxFUmxsUldHWlJiMlJYWkdORllrRWFLU29uQ2hoVlEwbGtSVWxJY0ZNd1ZHUnJjVkpyU0V3MVQydE1kRUVTQ3kweWNpMTZaa1ZKZG5CVklBRW9BVElhQ2hoVlEyMVhaMlpVUWxBeVowOXFVSEk1TVhWeVlWVjZjMUU0QWtnQlVBOCUzRA=="}}, "timestampColor": 2147483648, "contextMenuAccessibility": {"accessibilityData": {"label": "Chat actions"}}, "timestampText": {"simpleText": "1:59:28"}, "trackingParams": "CAQQ7rsEIhMIy5G9z_3mggMVgNlMAh3W1gHd", "textInputBackgroundColor": 822083583, "creatorHeartButton": {"creatorHeartViewModel": {"creatorThumbnail": {"sources": [{"url": "https://yt3.ggpht.com/Qj-lyidMW6xtEdnv6rDYscGE1kO6K06-i4v8Eiij96YOTo_WdBboLVlEKeE3749ywpyqTec2=s48-c-k-c0x00ffffff-no-rj"}]}, "heartedIcon": {"sources": [{"clientResource": {"imageName": "full_heart-filled"}}]}, "unheartedIcon": {"sources": [{"clientResource": {"imageName": "full_heart"}}], "processor": {"borderImageProcessor": {"imageTint": {"color": 3741319168}}}}, "heartedHoverText": "❤ by さなちゃんねる", "heartedAccessibilityLabel": "Remove heart", "unheartedAccessibilityLabel": "Heart", "engagementStateKey": "EktsaXZlLWNoYXQtbWVzc2FnZS1lbmdhZ2VtZW50LXN0YXRlLUNod0tHa05KZW5GdVlYcFJkbTlKUkVaWlVWaG1VVzlrVjJSalJXSkIgLCgB"}}, "isV2Style": true}}, "trackingParams": "CAMQjtEGIhMIy5G9z_3mggMVgNlMAh3W1gHd"}}, "authorExternalChannelId": "UCmWgfTBP2gOjPr91uraUzsQ", "fullDurationSec": 300, "trackingParams": "CAIQsMgEIhMIy5G9z_3mggMVgNlMAh3W1gHd", "authorUsername": {"simpleText": "のら"}}}, "durationSec": "300"}}], "videoOffsetTimeMsec": "7168211"}}'
    )
    assert json2csv._has_addChatItemAction(dat_True) == True
    assert json2csv._has_addChatItemAction(dat_False) == False


def test_has_addLiveChatTickerItemAction():
    dat_True = json.loads(
        '{"clickTrackingParams": "CAEQl98BIhMIy5G9z_3mggMVgNlMAh3W1gHd", "replayChatItemAction": {"actions": [{"clickTrackingParams": "CAEQl98BIhMIy5G9z_3mggMVgNlMAh3W1gHd", "addLiveChatTickerItemAction": {"item": {"liveChatTickerPaidMessageItemRenderer": {"id": "ChwKGkNJenFuYXpRdm9JREZZUVhmUW9kV2RjRWJB", "amountTextColor": 3741319168, "startBackgroundColor": 4294953512, "endBackgroundColor": 4294947584, "authorPhoto": {"thumbnails": [{"url": "https://yt4.ggpht.com/ytc/APkrFKb_CA1XB8fRw1jKL3eavN70M0HFONyNBdE13m9FOA=s32-c-k-c0x00ffffff-no-rj", "width": 32, "height": 32}, {"url": "https://yt4.ggpht.com/ytc/APkrFKb_CA1XB8fRw1jKL3eavN70M0HFONyNBdE13m9FOA=s64-c-k-c0x00ffffff-no-rj", "width": 64, "height": 64}], "accessibility": {"accessibilityData": {"label": "のら"}}}, "durationSec": 300, "showItemEndpoint": {"clickTrackingParams": "CAIQsMgEIhMIy5G9z_3mggMVgNlMAh3W1gHd", "commandMetadata": {"webCommandMetadata": {"ignoreNavigation": true}}, "showLiveChatItemEndpoint": {"renderer": {"liveChatPaidMessageRenderer": {"id": "ChwKGkNJenFuYXpRdm9JREZZUVhmUW9kV2RjRWJB", "timestampUsec": "1699797836186236", "authorName": {"simpleText": "のら"}, "authorPhoto": {"thumbnails": [{"url": "https://yt4.ggpht.com/ytc/APkrFKb_CA1XB8fRw1jKL3eavN70M0HFONyNBdE13m9FOA=s32-c-k-c0x00ffffff-no-rj", "width": 32, "height": 32}, {"url": "https://yt4.ggpht.com/ytc/APkrFKb_CA1XB8fRw1jKL3eavN70M0HFONyNBdE13m9FOA=s64-c-k-c0x00ffffff-no-rj", "width": 64, "height": 64}]}, "purchaseAmountText": {"simpleText": "¥1,000"}, "headerBackgroundColor": 4294947584, "headerTextColor": 3741319168, "bodyBackgroundColor": 4294953512, "bodyTextColor": 3741319168, "authorExternalChannelId": "UCmWgfTBP2gOjPr91uraUzsQ", "authorNameTextColor": 2315255808, "contextMenuEndpoint": {"clickTrackingParams": "CAQQ7rsEIhMIy5G9z_3mggMVgNlMAh3W1gHd", "commandMetadata": {"webCommandMetadata": {"ignoreNavigation": true}}, "liveChatItemContextMenuEndpoint": {"params": "Q2g0S0hBb2FRMGw2Y1c1aGVsRjJiMGxFUmxsUldHWlJiMlJYWkdORllrRWFLU29uQ2hoVlEwbGtSVWxJY0ZNd1ZHUnJjVkpyU0V3MVQydE1kRUVTQ3kweWNpMTZaa1ZKZG5CVklBRW9BVElhQ2hoVlEyMVhaMlpVUWxBeVowOXFVSEk1TVhWeVlWVjZjMUU0QWtnQlVBOCUzRA=="}}, "timestampColor": 2147483648, "contextMenuAccessibility": {"accessibilityData": {"label": "Chat actions"}}, "timestampText": {"simpleText": "1:59:28"}, "trackingParams": "CAQQ7rsEIhMIy5G9z_3mggMVgNlMAh3W1gHd", "textInputBackgroundColor": 822083583, "creatorHeartButton": {"creatorHeartViewModel": {"creatorThumbnail": {"sources": [{"url": "https://yt3.ggpht.com/Qj-lyidMW6xtEdnv6rDYscGE1kO6K06-i4v8Eiij96YOTo_WdBboLVlEKeE3749ywpyqTec2=s48-c-k-c0x00ffffff-no-rj"}]}, "heartedIcon": {"sources": [{"clientResource": {"imageName": "full_heart-filled"}}]}, "unheartedIcon": {"sources": [{"clientResource": {"imageName": "full_heart"}}], "processor": {"borderImageProcessor": {"imageTint": {"color": 3741319168}}}}, "heartedHoverText": "❤ by さなちゃんねる", "heartedAccessibilityLabel": "Remove heart", "unheartedAccessibilityLabel": "Heart", "engagementStateKey": "EktsaXZlLWNoYXQtbWVzc2FnZS1lbmdhZ2VtZW50LXN0YXRlLUNod0tHa05KZW5GdVlYcFJkbTlKUkVaWlVWaG1VVzlrVjJSalJXSkIgLCgB"}}, "isV2Style": true}}, "trackingParams": "CAMQjtEGIhMIy5G9z_3mggMVgNlMAh3W1gHd"}}, "authorExternalChannelId": "UCmWgfTBP2gOjPr91uraUzsQ", "fullDurationSec": 300, "trackingParams": "CAIQsMgEIhMIy5G9z_3mggMVgNlMAh3W1gHd", "authorUsername": {"simpleText": "のら"}}}, "durationSec": "300"}}], "videoOffsetTimeMsec": "7168211"}}'
    )
    dat_False = json.loads(
        '{"clickTrackingParams": "CAEQl98BIhMIs7qIyKuEgwMVmchMAh0LIwfj", "replayChatItemAction": {"actions": [{"clickTrackingParams": "CAEQl98BIhMIs7qIyKuEgwMVmchMAh0LIwfj", "addChatItemAction": {"item": {"liveChatPaidMessageRenderer": {"id": "ChwKGkNLUGg3N3otMllJREZTUEN3Z1FkSWxrRTJB", "timestampUsec": "1700737983561607", "authorName": {"simpleText": "Jack Krauser"}, "authorPhoto": {"thumbnails": [{"url": "https://yt4.ggpht.com/ytc/APkrFKZx0LwFARGyWQmtlUlNeq1XcwEe0JZhstf6cQ=s32-c-k-c0x00ffffff-no-rj", "width": 32, "height": 32}, {"url": "https://yt4.ggpht.com/ytc/APkrFKZx0LwFARGyWQmtlUlNeq1XcwEe0JZhstf6cQ=s64-c-k-c0x00ffffff-no-rj", "width": 64, "height": 64}]}, "purchaseAmountText": {"simpleText": "NT$30.00"}, "message": {"runs": [{"text": "ヴォカルすげー"}]}, "headerBackgroundColor": 4278237396, "headerTextColor": 4278190080, "bodyBackgroundColor": 4278248959, "bodyTextColor": 4278190080, "authorExternalChannelId": "UCo_8LZtKaasyYncLnKjnMXA", "authorNameTextColor": 3003121664, "contextMenuEndpoint": {"clickTrackingParams": "CAIQ7rsEIhMIs7qIyKuEgwMVmchMAh0LIwfj", "commandMetadata": {"webCommandMetadata": {"ignoreNavigation": true}}, "liveChatItemContextMenuEndpoint": {"params": "Q2g0S0hBb2FRMHRRYURjM2VpMHlXVWxFUmxOUVEzZG5VV1JKYkd0Rk1rRWFLU29uQ2hoVlEwbGtSVWxJY0ZNd1ZHUnJjVkpyU0V3MVQydE1kRUVTQzNaWlVHTnBVMXBQYVVOVklBRW9BVElhQ2hoVlEyOWZPRXhhZEV0aFlYTjVXVzVqVEc1TGFtNU5XRUU0QWtnQlVBOCUzRA=="}}, "timestampColor": 2147483648, "contextMenuAccessibility": {"accessibilityData": {"label": "Chat actions"}}, "timestampText": {"simpleText": "13:36"}, "trackingParams": "CAIQ7rsEIhMIs7qIyKuEgwMVmchMAh0LIwfj", "textInputBackgroundColor": 822083583, "creatorHeartButton": {"creatorHeartViewModel": {"creatorThumbnail": {"sources": [{"url": "https://yt3.ggpht.com/Qj-lyidMW6xtEdnv6rDYscGE1kO6K06-i4v8Eiij96YOTo_WdBboLVlEKeE3749ywpyqTec2=s48-c-k-c0x00ffffff-no-rj"}]}, "heartedIcon": {"sources": [{"clientResource": {"imageName": "full_heart-filled"}}]}, "unheartedIcon": {"sources": [{"clientResource": {"imageName": "full_heart"}}], "processor": {"borderImageProcessor": {"imageTint": {"color": 4278190080}}}}, "heartedHoverText": "❤ by さなちゃんねる", "heartedAccessibilityLabel": "Remove heart", "unheartedAccessibilityLabel": "Heart", "engagementStateKey": "EktsaXZlLWNoYXQtbWVzc2FnZS1lbmdhZ2VtZW50LXN0YXRlLUNod0tHa05MVUdnM04zb3RNbGxKUkVaVFVFTjNaMUZrU1d4clJUSkIgLCgB"}}, "isV2Style": true}}, "clientId": "CKPh77z-2YIDFSPCwgQdIlkE2A"}}], "videoOffsetTimeMsec": "816855"}}'
    )
    assert json2csv._has_addLiveChatTickerItemAction(dat_True) == True
    assert json2csv._has_addLiveChatTickerItemAction(dat_False) == False


def test_has_clickTrackingParams():
    dat_True = json.loads(
        '{"clickTrackingParams": "CAEQl98BIhMIy5G9z_3mggMVgNlMAh3W1gHd", "replayChatItemAction": {"actions": [{"clickTrackingParams": "CAEQl98BIhMIy5G9z_3mggMVgNlMAh3W1gHd", "addLiveChatTickerItemAction": {"item": {"liveChatTickerPaidMessageItemRenderer": {"id": "ChwKGkNJenFuYXpRdm9JREZZUVhmUW9kV2RjRWJB", "amountTextColor": 3741319168, "startBackgroundColor": 4294953512, "endBackgroundColor": 4294947584, "authorPhoto": {"thumbnails": [{"url": "https://yt4.ggpht.com/ytc/APkrFKb_CA1XB8fRw1jKL3eavN70M0HFONyNBdE13m9FOA=s32-c-k-c0x00ffffff-no-rj", "width": 32, "height": 32}, {"url": "https://yt4.ggpht.com/ytc/APkrFKb_CA1XB8fRw1jKL3eavN70M0HFONyNBdE13m9FOA=s64-c-k-c0x00ffffff-no-rj", "width": 64, "height": 64}], "accessibility": {"accessibilityData": {"label": "のら"}}}, "durationSec": 300, "showItemEndpoint": {"clickTrackingParams": "CAIQsMgEIhMIy5G9z_3mggMVgNlMAh3W1gHd", "commandMetadata": {"webCommandMetadata": {"ignoreNavigation": true}}, "showLiveChatItemEndpoint": {"renderer": {"liveChatPaidMessageRenderer": {"id": "ChwKGkNJenFuYXpRdm9JREZZUVhmUW9kV2RjRWJB", "timestampUsec": "1699797836186236", "authorName": {"simpleText": "のら"}, "authorPhoto": {"thumbnails": [{"url": "https://yt4.ggpht.com/ytc/APkrFKb_CA1XB8fRw1jKL3eavN70M0HFONyNBdE13m9FOA=s32-c-k-c0x00ffffff-no-rj", "width": 32, "height": 32}, {"url": "https://yt4.ggpht.com/ytc/APkrFKb_CA1XB8fRw1jKL3eavN70M0HFONyNBdE13m9FOA=s64-c-k-c0x00ffffff-no-rj", "width": 64, "height": 64}]}, "purchaseAmountText": {"simpleText": "¥1,000"}, "headerBackgroundColor": 4294947584, "headerTextColor": 3741319168, "bodyBackgroundColor": 4294953512, "bodyTextColor": 3741319168, "authorExternalChannelId": "UCmWgfTBP2gOjPr91uraUzsQ", "authorNameTextColor": 2315255808, "contextMenuEndpoint": {"clickTrackingParams": "CAQQ7rsEIhMIy5G9z_3mggMVgNlMAh3W1gHd", "commandMetadata": {"webCommandMetadata": {"ignoreNavigation": true}}, "liveChatItemContextMenuEndpoint": {"params": "Q2g0S0hBb2FRMGw2Y1c1aGVsRjJiMGxFUmxsUldHWlJiMlJYWkdORllrRWFLU29uQ2hoVlEwbGtSVWxJY0ZNd1ZHUnJjVkpyU0V3MVQydE1kRUVTQ3kweWNpMTZaa1ZKZG5CVklBRW9BVElhQ2hoVlEyMVhaMlpVUWxBeVowOXFVSEk1TVhWeVlWVjZjMUU0QWtnQlVBOCUzRA=="}}, "timestampColor": 2147483648, "contextMenuAccessibility": {"accessibilityData": {"label": "Chat actions"}}, "timestampText": {"simpleText": "1:59:28"}, "trackingParams": "CAQQ7rsEIhMIy5G9z_3mggMVgNlMAh3W1gHd", "textInputBackgroundColor": 822083583, "creatorHeartButton": {"creatorHeartViewModel": {"creatorThumbnail": {"sources": [{"url": "https://yt3.ggpht.com/Qj-lyidMW6xtEdnv6rDYscGE1kO6K06-i4v8Eiij96YOTo_WdBboLVlEKeE3749ywpyqTec2=s48-c-k-c0x00ffffff-no-rj"}]}, "heartedIcon": {"sources": [{"clientResource": {"imageName": "full_heart-filled"}}]}, "unheartedIcon": {"sources": [{"clientResource": {"imageName": "full_heart"}}], "processor": {"borderImageProcessor": {"imageTint": {"color": 3741319168}}}}, "heartedHoverText": "❤ by さなちゃんねる", "heartedAccessibilityLabel": "Remove heart", "unheartedAccessibilityLabel": "Heart", "engagementStateKey": "EktsaXZlLWNoYXQtbWVzc2FnZS1lbmdhZ2VtZW50LXN0YXRlLUNod0tHa05KZW5GdVlYcFJkbTlKUkVaWlVWaG1VVzlrVjJSalJXSkIgLCgB"}}, "isV2Style": true}}, "trackingParams": "CAMQjtEGIhMIy5G9z_3mggMVgNlMAh3W1gHd"}}, "authorExternalChannelId": "UCmWgfTBP2gOjPr91uraUzsQ", "fullDurationSec": 300, "trackingParams": "CAIQsMgEIhMIy5G9z_3mggMVgNlMAh3W1gHd", "authorUsername": {"simpleText": "のら"}}}, "durationSec": "300"}}], "videoOffsetTimeMsec": "7168211"}}'
    )
    dat_False = json.loads(
        '{"replayChatItemAction": {"actions": [{"addChatItemAction": {"item": {"liveChatTextMessageRenderer": {"message": {"runs": [{"text": "たすかる"}]}, "authorName": {"simpleText": "A!L35(エール)"}, "authorPhoto": {"thumbnails": [{"url": "https://yt4.ggpht.com/TUf4hLT63VhjthxPU0y_zHpH5P-EHWi1F_pjWL6f5tpDqe-bPoTD3yxlXl-aHq6aA5Xn_t-QXUE=s32-c-k-c0x00ffffff-no-rj", "width": 32, "height": 32}, {"url": "https://yt4.ggpht.com/TUf4hLT63VhjthxPU0y_zHpH5P-EHWi1F_pjWL6f5tpDqe-bPoTD3yxlXl-aHq6aA5Xn_t-QXUE=s64-c-k-c0x00ffffff-no-rj", "width": 64, "height": 64}]}, "contextMenuEndpoint": {"commandMetadata": {"webCommandMetadata": {"ignoreNavigation": true}}, "liveChatItemContextMenuEndpoint": {"params": "Q2g0S0hBb2FRMG95U0hFMFZ6SjJiMGxFUm1ZM1EzZG5VV1JFTTFWTmFuY2FLU29uQ2hoVlEwbGtSVWxJY0ZNd1ZHUnJjVkpyU0V3MVQydE1kRUVTQ3kweWNpMTZaa1ZKZG5CVklBRW9BVElhQ2hoVlEycGxWMmhtVVUxVWNVaHRTMUozTVVaMU1HcGxjVkU0QWtnQlVBRSUzRA=="}}, "id": "ChwKGkNKMkhxNFcydm9JREZmN0N3Z1FkRDNVTWp3", "timestampUsec": "1699790763789196", "authorExternalChannelId": "UCjeWhfQMTqHmKRw1Fu0jeqQ", "contextMenuAccessibility": {"accessibilityData": {"label": "Chat actions"}}, "timestampText": {"simpleText": "1:47"}}}, "clientId": "CJ2Hq4W2voIDFf7CwgQdD3UMjw"}}], "videoOffsetTimeMsec": "107396"}}'
    )
    assert json2csv._has_clickTrackingParams(dat_True) == True
    assert json2csv._has_clickTrackingParams(dat_False) == False


def test_make_dataframe():
    df = json2csv.make_dataframe(sample_file_path)
    assert df["author_name"].iloc[0] == "モラン"
    assert "offset_time" in df.columns
    assert "timestamp_text" in df.columns
    assert "message_text" in df.columns
    assert "author_ch_id" in df.columns
    assert "author_name" in df.columns
    assert df.shape[0] > 1
    assert df.isnull().values.sum() == 0
